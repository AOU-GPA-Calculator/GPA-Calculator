<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>AOU GPA Calculator – Current GPA</title>

  <meta name="description" content="Calculate your current GPA (AOU 4.0 scale) using course grades (0–100) and credit hours, with merit classification and retake replacement." />
  <meta name="author" content="Homam Shaaban" />
  <meta name="robots" content="index, follow" />
  <link rel="canonical" href="https://aou-gpa-calculator.github.io/GPA-Calculator/current-gpa.html" />

  <link rel="preconnect" href="https://fonts.googleapis.com" />
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet" />

  <style>
    :root{
      --bg1:#071a2b;
      --bg2:#0b2a44;

      --surface: rgba(0, 32, 63, .66);
      --surfaceBorder: rgba(255,255,255,.14);

      --card: rgba(255,255,255,.08);
      --cardBorder: rgba(255,255,255,.18);

      --text:#eaf2ff;
      --muted: rgba(234,242,255,.82);

      --accent:#f7b500;
      --accentHover:#ffd35c;

      --dangerBg: rgba(255,0,0,.18);
      --dangerBorder: rgba(255,140,140,.95);

      --radius: 22px;
      --shadow: 0 20px 60px rgba(0,0,0,.45);
    }

    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;
      font-family:"Inter",system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;
      color:var(--text);
      background:
        radial-gradient(1100px 700px at 10% 10%, rgba(34,193,195,.22), transparent 55%),
        radial-gradient(900px 600px at 90% 20%, rgba(247,181,0,.18), transparent 60%),
        linear-gradient(135deg,var(--bg1),var(--bg2));
      overflow-x:hidden;
    }

    .orb{
      position:fixed; width:420px; height:420px; border-radius:999px;
      filter:blur(44px); opacity:.22; pointer-events:none;
      animation: floaty 10s ease-in-out infinite; z-index:0;
    }
    .orb.one{left:-140px; top:90px; background: rgba(34,193,195,.65)}
    .orb.two{right:-180px; top:40px; background: rgba(247,181,0,.55); animation-delay:-3s}
    .orb.three{right:18%; bottom:-240px; width:520px; height:520px; background: rgba(10,93,150,.70); animation-delay:-6s}
    @keyframes floaty{0%,100%{transform:translate(0,0)}50%{transform:translate(10px,-18px)}}
    @keyframes fadeUp{from{opacity:0;transform:translateY(18px)}to{opacity:1;transform:translateY(0)}}

    header{
      text-align:center;
      padding: 26px 16px 8px;
      position:relative;
      z-index:1;
      animation: fadeUp .7s ease-out both;
    }
    header img{
      width:152px;
      filter: drop-shadow(0 10px 22px rgba(0,0,0,.25));
    }

    .wrap{
      min-height: calc(100vh - 90px);
      display:flex;
      justify-content:center;
      padding: 14px 16px 54px;
      position:relative;
      z-index:1;
    }

    .container{
      width:min(1040px, 100%);
      background: var(--surface);
      border: 1px solid var(--surfaceBorder);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding: 28px 26px 24px;
      backdrop-filter: blur(12px);
      -webkit-backdrop-filter: blur(12px);
      animation: fadeUp .85s ease-out both;
    }

    .topbar{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      margin-bottom: 10px;
    }

    .chip{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.06);
      color: var(--text);
      text-decoration:none;
      cursor:pointer;
      user-select:none;
      font-weight:600;
      font-size:.92rem;
    }
    .chip:hover{ background: rgba(255,255,255,.12); }
    .chip:focus-visible{ outline:3px solid rgba(255,211,92,.55); outline-offset:3px; }

    h1{
      margin: 8px 0 6px;
      text-align:center;
      font-size: clamp(24px, 3.2vw, 38px);
      letter-spacing:-.02em;
    }

    .subtitle{
      margin:0 auto 14px;
      text-align:center;
      max-width: 80ch;
      color: var(--muted);
      line-height:1.55;
      font-size:.98rem;
    }

    .note{
      margin: 0 auto 12px;
      max-width: 90ch;
      padding: 10px 12px;
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      border: 1px solid rgba(255,255,255,.14);
      color: var(--muted);
      line-height: 1.55;
      font-size: .92rem;
      text-align:center;
    }

    .section{
      background: var(--card);
      border: 1px solid var(--cardBorder);
      border-radius: 18px;
      padding: 16px;
      margin-top: 14px;
      backdrop-filter: blur(10px);
      -webkit-backdrop-filter: blur(10px);
      position:relative;
      overflow:hidden;
    }
    .section::before{
      content:"";
      position:absolute;
      inset:-45%;
      background: radial-gradient(circle at 18% 18%, rgba(255,255,255,.16), transparent 45%);
      transform: rotate(12deg);
      opacity:.9;
      pointer-events:none;
    }
    .section > *{ position:relative; z-index:1; }

    .tableWrap{
      overflow:auto;
      border-radius: 14px;
      border: 1px solid rgba(255,255,255,.16);
    }

    table{
      width:100%;
      border-collapse: collapse;
      min-width: 880px;
      background: rgba(0,0,0,.08);
    }

    th, td{
      padding: 12px 10px;
      border-bottom: 1px solid rgba(255,255,255,.12);
      text-align:left;
      white-space:nowrap;
      vertical-align: middle;
    }

    th{
      font-size: .9rem;
      color: rgba(234,242,255,.90);
      letter-spacing:.01em;
      background: rgba(255,255,255,.06);
    }

    .field{
      width: 100%;
      padding: 10px 10px;
      border-radius: 12px;
      border: 1.8px solid rgba(255,255,255,.22);
      background: rgba(255,255,255,.10);
      color: var(--text);
      font-size: 1rem;
      outline:none;
    }
    .field:focus{
      border-color: rgba(255,211,92,.70);
      box-shadow: 0 0 0 3px rgba(255,211,92,.18);
    }
    .field::placeholder{ color: rgba(234,242,255,.55); }

    input[type=number]::-webkit-inner-spin-button,
    input[type=number]::-webkit-outer-spin-button{ -webkit-appearance:none; }
    input[type=number]{ -moz-appearance:textfield; }

    .tiny{ font-size: .88rem; color: var(--muted); }

    .status{
      display:inline-flex;
      align-items:center;
      gap:8px;
      padding: 6px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.16);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      font-weight: 700;
      font-size: .82rem;
    }
    .status.ok{ color: rgba(234,242,255,.88); }
    .status.replaced{
      color: #ffd1d1;
      border-color: rgba(255,140,140,.55);
      background: rgba(255,0,0,.10);
    }

    .btnRow{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      margin-top: 12px;
    }

    .btn{
      flex: 1 1 180px;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 8px;
      padding: 12px 14px;
      border-radius: 999px;
      border: 1px solid rgba(0,0,0,.08);
      background: var(--accent);
      color:#0b2a44;
      font-weight: 800;
      cursor:pointer;
      user-select:none;
      transition: transform .15s ease, filter .15s ease;
    }
    .btn:hover{ filter: brightness(1.05); background: var(--accentHover); transform: translateY(-1px); }
    .btn:active{ transform: translateY(0); }
    .btn:focus-visible{ outline:3px solid rgba(255,211,92,.55); outline-offset:3px; }

    .btn.secondary{
      background: rgba(255,255,255,.10);
      color: var(--text);
      border: 1px solid rgba(255,255,255,.18);
      font-weight: 700;
    }
    .btn.secondary:hover{ background: rgba(255,255,255,.16); filter:none; }

    .iconBtn{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.08);
      color: var(--text);
      cursor:pointer;
      user-select:none;
      font-weight:700;
    }
    .iconBtn:hover{ background: rgba(255,255,255,.14); }
    .iconBtn:focus-visible{ outline:3px solid rgba(255,211,92,.55); outline-offset:3px; }
    .iconBtn svg{ width:16px; height:16px; fill: currentColor; }

    .error{
      display:none;
      margin-top: 10px;
      padding: 10px 12px;
      border-radius: 12px;
      background: var(--dangerBg);
      border: 1px solid var(--dangerBorder);
      color: #ffd5d5;
      line-height:1.4;
    }

    .result{
      margin-top: 12px;
      display:flex;
      align-items:center;
      justify-content:center;
      flex-direction:column;
      gap: 8px;
      text-align:center;
    }

    .big{
      font-size: clamp(28px, 4vw, 44px);
      font-weight: 800;
      letter-spacing:-.02em;
    }
    .pill{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap: 10px;
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.18);
      background: rgba(255,255,255,.06);
      color: var(--muted);
      margin: 0 auto;
      width: fit-content;
      flex-wrap:wrap;
    }

    details{ margin-top: 8px; }
    details summary{
      cursor:pointer; user-select:none; font-weight:700;
      color: rgba(234,242,255,.92);
      outline:none;
    }
    details summary:focus-visible{ outline:3px solid rgba(255,211,92,.55); outline-offset:3px; border-radius:10px; }

    footer{
      margin-top: 16px;
      text-align:center;
      font-size: .85rem;
      color: var(--muted);
      line-height:1.6;
    }

    @media print{
      body{ background:#fff; color:#000; }
      .orb, header{ display:none !important; }
      .container{ box-shadow:none !important; border:none !important; background:#fff !important; color:#000 !important; }
      .chip, .btnRow, .btn, .iconBtn{ display:none !important; }
      table{ min-width: auto; }
      th,td{ color:#000; border-color:#ddd; }
      .field{ border:1px solid #ddd; background:#fff; color:#000; }
      .status{ border-color:#ddd; background:#f6f6f6; color:#000; }
    }

    @media (max-width: 720px){
      .container{ padding: 22px 16px; }
      table{ min-width: 820px; }
    }

    @media (prefers-reduced-motion: reduce){
      .orb, header, .container{ animation:none !important; }
      .btn{ transition:none !important; }
    }
  </style>
</head>

<body>
  <div class="orb one"></div>
  <div class="orb two"></div>
  <div class="orb three"></div>

  <header>
    <img src="aou-logo.png" alt="Arab Open University Logo" />
  </header>

  <div class="wrap">
    <main class="container" role="main" aria-label="Current GPA Calculator">
      <div class="topbar">
        <a class="chip" href="index.html" aria-label="Back to Home"><span aria-hidden="true">←</span> Home</a>
        <div style="display:flex; gap:10px; flex-wrap:wrap;">
          <button class="chip" type="button" id="btnAuto">Auto-Calculate: ON</button>
          <button class="chip" type="button" id="btnReset">Reset</button>
        </div>
      </div>

      <h1>Current GPA Calculator</h1>
      <p class="subtitle">Enter course code, grade (0–100) and credit hours. GPA updates automatically.</p>

      <div class="note">
        <strong>Retake Rule:</strong> If you enter the same <u>Course Code</u> multiple times, only the <strong>latest attempt</strong> is counted (previous attempts become <strong>Replaced</strong>).
      </div>

      <section class="section" aria-label="Courses">
        <div class="tableWrap" aria-label="Courses table">
          <table>
            <thead>
              <tr>
                <th style="width:190px;">Course Code</th>
                <th style="width:210px;">Grade (0–100)</th>
                <th style="width:180px;">Credit Hours</th>
                <th style="width:140px;">GPA Points</th>
                <th style="width:170px;">Status</th>
                <th style="width:130px;">Action</th>
              </tr>
            </thead>
            <tbody id="tbody"></tbody>
          </table>
        </div>

        <div class="btnRow">
          <button class="btn" type="button" id="btnAdd">Add Course</button>
          <button class="btn secondary" type="button" id="btnCalc">Calculate</button>
          <button class="btn secondary" type="button" id="btnExport">Export (JSON)</button>
          <label class="btn secondary" style="cursor:pointer;">
            Import (JSON)
            <input id="fileImport" type="file" accept="application/json" style="display:none;">
          </label>
          <button class="btn secondary" type="button" onclick="window.print()">Print</button>
        </div>

        <div id="error" class="error"></div>

        <div class="result" aria-live="polite">
          <div class="big"><span id="gpa">0.00</span></div>
          <div class="pill">
            <span>Current GPA</span>
            <span id="merit"></span>
          </div>

          <details>
            <summary>Show details</summary>
            <div class="tiny" style="margin-top:10px; line-height:1.65;">
              <div><strong>Total Credit Hours (counted):</strong> <span id="totalCH">0</span></div>
              <div><strong>Total Quality Points:</strong> <span id="totalQP">0.00</span></div>
              <div class="tiny" style="margin-top:6px;">
                Rows marked <strong>Replaced</strong> are excluded due to retake replacement.
              </div>
            </div>
          </details>
        </div>
      </section>

      <footer>
        © 2025 – AOU GPA Calculator. Developed by Homam Shaaban – Faculty of Computer Studies (Networks &amp; Information Security).
      </footer>
    </main>
  </div>

  <script>
    // ===== AOU ranges (same as your original) =====
    function convertToGPA(g){
      if (g >= 90) return 4.0;
      if (g >= 82) return 3.5;
      if (g >= 74) return 3.0;
      if (g >= 66) return 2.5;
      if (g >= 58) return 2.0;
      if (g >= 50) return 1.5;
      return 0.0;
    }

    function getMerit(g){
      if (g >= 3.67) return { t:"Excellent", c:"#7CFC00" };
      if (g >= 3.00) return { t:"Very Good", c:"#ADFF2F" };
      if (g >= 2.33) return { t:"Good", c:"#F0E68C" };
      if (g >= 2.00) return { t:"Pass", c:"#FFD700" };
      return { t:"Fail", c:"#FF4C4C" };
    }

    const STORAGE_KEY = "aouGpaStateRetakeV1";
    const el = (id) => document.getElementById(id);

    let autoCalc = true;
    let rowId = 0;

    function showError(msg){
      const box = el("error");
      box.textContent = msg;
      box.style.display = "block";
    }
    function clearError(){
      const box = el("error");
      box.textContent = "";
      box.style.display = "none";
    }

    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function normalizeCode(code){
      return (code || "").trim().toUpperCase();
    }

    function createRow(data = {}){
      rowId++;
      const tr = document.createElement("tr");
      tr.dataset.row = String(rowId);

      tr.innerHTML = `
        <td>
          <input class="field" type="text" placeholder="e.g., ITC101" value="${escapeHtml(data.code || "")}" aria-label="Course code" />
        </td>
        <td>
          <input class="field" inputmode="numeric" type="number" min="0" max="100" placeholder="e.g., 85" value="${data.grade ?? ""}" aria-label="Course grade" />
        </td>
        <td>
          <input class="field" inputmode="numeric" type="number" min="1" placeholder="e.g., 3" value="${data.credits ?? ""}" aria-label="Credit hours" />
        </td>
        <td class="tiny" data-points>–</td>
        <td>
          <span class="status ok" data-status>Counted</span>
        </td>
        <td>
          <button class="iconBtn" type="button" aria-label="Remove course">
            <svg viewBox="0 0 24 24"><path d="M9 3h6l1 2h5v2H3V5h5l1-2zm1 6h2v10h-2V9zm4 0h2v10h-2V9zM7 9h2v10H7V9z"/></svg>
            Remove
          </button>
        </td>
      `;

      const inputs = tr.querySelectorAll("input");
      inputs.forEach(inp=>{
        inp.addEventListener("input", ()=>{
          if (autoCalc) calculate(true);
          saveState();
        });
        inp.addEventListener("change", ()=>{
          if (autoCalc) calculate(true);
          saveState();
        });
      });

      tr.querySelector("button").addEventListener("click", ()=>{
        tr.remove();
        if (autoCalc) calculate(true);
        saveState();
      });

      el("tbody").appendChild(tr);
      if (autoCalc) calculate(true);
    }

    function readRow(tr){
      const [codeEl, gradeEl, creditsEl] = tr.querySelectorAll("input");
      const code = normalizeCode(codeEl.value);

      const gStr = gradeEl.value.trim();
      const cStr = creditsEl.value.trim();

      const grade = (gStr === "") ? null : Number(gStr);
      const credits = (cStr === "") ? null : Number(cStr);

      return { code, grade, credits };
    }

    // Retake replacement:
    // For same course code (non-empty), ONLY the latest row counts.
    function buildCountMap(rows){
      const lastIndexByCode = new Map(); // code -> last row index
      rows.forEach((tr, idx)=>{
        const { code } = readRow(tr);
        if (code) lastIndexByCode.set(code, idx);
      });
      return lastIndexByCode;
    }

    function calculate(silent=false){
      clearError();

      const rows = Array.from(el("tbody").querySelectorAll("tr"));
      if (rows.length === 0){
        el("gpa").textContent = "0.00";
        el("merit").textContent = "";
        el("totalCH").textContent = "0";
        el("totalQP").textContent = "0.00";
        return;
      }

      const lastIndexByCode = buildCountMap(rows);

      let totalQP = 0;
      let totalCH = 0;

      rows.forEach((tr, idx)=>{
        const { code, grade, credits } = readRow(tr);

        const pointsCell = tr.querySelector("[data-points]");
        const statusEl = tr.querySelector("[data-status]");

        const isDuplicateCode = !!code && lastIndexByCode.get(code) !== idx;

        if (isDuplicateCode){
          pointsCell.textContent = "–";
          statusEl.textContent = "Replaced";
          statusEl.className = "status replaced";
          return; // excluded
        }

        statusEl.textContent = "Counted";
        statusEl.className = "status ok";

        // auto-friendly: empty inputs show dash and not counted
        if (grade === null || credits === null){
          pointsCell.textContent = "–";
          return;
        }

        if (!Number.isFinite(grade) || grade < 0 || grade > 100){
          pointsCell.textContent = "–";
          if (!silent) showError("Invalid grade. Each grade must be between 0 and 100.");
          return;
        }

        if (!Number.isFinite(credits) || credits <= 0){
          pointsCell.textContent = "–";
          if (!silent) showError("Invalid credit hours. Each course must have positive credit hours.");
          return;
        }

        const gpaPoints = convertToGPA(grade);
        pointsCell.textContent = gpaPoints.toFixed(2);

        totalQP += gpaPoints * credits;
        totalCH += credits;
      });

      if (totalCH <= 0){
        el("gpa").textContent = "0.00";
        el("merit").textContent = "";
        el("totalCH").textContent = "0";
        el("totalQP").textContent = "0.00";
        return;
      }

      const gpa = totalQP / totalCH;
      el("gpa").textContent = gpa.toFixed(2);

      const merit = getMerit(gpa);
      const m = el("merit");
      m.textContent = `– ${merit.t}`;
      m.style.color = merit.c;

      el("totalCH").textContent = String(totalCH.toFixed(0));
      el("totalQP").textContent = totalQP.toFixed(2);
    }

    function resetAll(){
      el("tbody").innerHTML = "";
      rowId = 0;
      clearError();
      try{ localStorage.removeItem(STORAGE_KEY); }catch(e){}
      createRow();
      calculate(true);
    }

    function saveState(){
      const rows = Array.from(el("tbody").querySelectorAll("tr")).map(tr => readRow(tr));
      try{ localStorage.setItem(STORAGE_KEY, JSON.stringify({ rows })); }catch(e){}
    }

    function restoreState(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw){ createRow(); return; }
        const data = JSON.parse(raw);
        if (!data.rows || !Array.isArray(data.rows) || data.rows.length === 0){
          createRow(); return;
        }
        data.rows.forEach(r => createRow({ code: r.code, grade: r.grade, credits: r.credits }));
        calculate(true);
      }catch(e){
        createRow();
      }
    }

    function exportJSON(){
      const rows = Array.from(el("tbody").querySelectorAll("tr")).map(tr => readRow(tr));
      const payload = {
        app: "AOU GPA Calculator",
        version: "RetakeReplacement-1.0",
        exportedAt: new Date().toISOString(),
        rows
      };
      const blob = new Blob([JSON.stringify(payload, null, 2)], {type:"application/json"});
      const a = document.createElement("a");
      a.href = URL.createObjectURL(blob);
      a.download = "aou-gpa-data.json";
      a.click();
      URL.revokeObjectURL(a.href);
    }

    function importJSON(file){
      const reader = new FileReader();
      reader.onload = () => {
        try{
          const data = JSON.parse(String(reader.result || ""));
          const rows = data.rows;
          if (!Array.isArray(rows) || rows.length === 0){
            return showError("Invalid file format. No rows found.");
          }
          el("tbody").innerHTML = "";
          rowId = 0;
          rows.forEach(r => createRow({ code: r.code, grade: r.grade, credits: r.credits }));
          calculate(true);
          saveState();
        }catch(e){
          showError("Invalid JSON file.");
        }
      };
      reader.readAsText(file);
    }

    window.addEventListener("DOMContentLoaded", ()=>{
      el("btnAdd").addEventListener("click", ()=> { createRow(); saveState(); });
      el("btnCalc").addEventListener("click", ()=> calculate(false));

      el("btnAuto").addEventListener("click", ()=>{
        autoCalc = !autoCalc;
        el("btnAuto").textContent = `Auto-Calculate: ${autoCalc ? "ON" : "OFF"}`;
        if (autoCalc) calculate(true);
      });

      el("btnReset").addEventListener("click", resetAll);
      el("btnExport").addEventListener("click", exportJSON);

      el("fileImport").addEventListener("change", (e)=>{
        const f = e.target.files && e.target.files[0];
        if (f) importJSON(f);
        e.target.value = "";
      });

      restoreState();
    });
  </script>
</body>
</html>
