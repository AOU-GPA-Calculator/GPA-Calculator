<!DOCTYPE html>
<html lang="en" dir="ltr" data-theme="dark">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />

  <title>AOU GPA Calculator</title>
  <meta name="description" content="AOU GPA Calculator ‚Äì Calculate semester GPA and estimate cumulative GPA on a 4.0 scale." />
  <meta name="author" content="Homam Shaaban" />
  <meta name="robots" content="index, follow" />

  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Cairo:wght@400;500;700;800;900&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg1:#061b2c;
      --bg2:#0a2b45;

      --card1: rgba(255,255,255,.08);
      --card2: rgba(255,255,255,.06);
      --border: rgba(255,255,255,.14);

      --text:#eaf2ff;
      --muted: rgba(234,242,255,.72);

      --gold:#f6b100;
      --gold2:#ffbf2f;

      --shadow: 0 16px 44px rgba(0,0,0,.32);
      --radius: 20px;

      --input: rgba(255,255,255,.10);
      --inputBorder: rgba(255,255,255,.16);

      --danger:#ff5b5b;
      --ok:#4ee29a;

      --btnBg: rgba(255,255,255,.06);
      --focus: rgba(246,177,0,.26);

      --mono: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace;

      --toastBorder: rgba(78,226,154,.40);
      --toastBg: rgba(6,27,44,.86);
      --toastText: rgba(210,255,235,.95);
    }

    html[data-theme="light"]{
      --bg1:#f6f8ff;
      --bg2:#eef2ff;

      --card1: rgba(0,0,0,.03);
      --card2: rgba(0,0,0,.02);
      --border: rgba(0,0,0,.10);

      --text:#0b1220;
      --muted: rgba(11,18,32,.65);

      --shadow: 0 14px 40px rgba(10,25,45,.10);

      --input: rgba(0,0,0,.03);
      --inputBorder: rgba(0,0,0,.12);

      --btnBg: rgba(255,255,255,.75);
      --focus: rgba(246,177,0,.22);

      --toastBorder: rgba(16,185,129,.35);
      --toastBg: rgba(255,255,255,.92);
      --toastText: rgba(11,18,32,.92);
    }

    *{ box-sizing:border-box; }
    body{
      margin:0;
      min-height:100vh;
      font-family:"Cairo", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      color:var(--text);
      background:
        radial-gradient(900px 420px at 20% 10%, rgba(246,177,0,.13), transparent 60%),
        radial-gradient(900px 420px at 80% 20%, rgba(78,226,154,.10), transparent 55%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }

    .wrap{
      max-width: 1060px;
      margin: 26px auto 60px;
      padding: 0 16px;
    }

    .toast{
      position: fixed;
      top: 14px;
      left: 14px;
      right: 14px;
      margin: 0 auto;
      max-width: 680px;
      display:none;
      z-index: 999;
      border-radius: 16px;
      padding: 12px 14px;
      border: 1px solid var(--toastBorder);
      background: var(--toastBg);
      backdrop-filter: blur(10px);
      box-shadow: var(--shadow);
      color: var(--toastText);
      font-weight: 900;
      text-align: center;
    }

    /* ===== Topbar ===== */
    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      flex-wrap: wrap;
      margin-bottom: 14px;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:14px;
      min-width: 260px;
    }
    .logo{
      width: 84px;
      height: 52px;
      object-fit: contain;
      border-radius: 12px;
      background: rgba(255,255,255,.90);
      padding: 6px;
      border: 1px solid rgba(0,0,0,.08);
    }
    html[data-theme="dark"] .logo{
      background: rgba(255,255,255,.92);
    }

    .titleBlock h1{
      margin:0;
      font-size: 28px;
      line-height: 1.15;
      font-weight: 900;
    }
    .titleBlock p{
      margin:6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.5;
      font-weight: 500;
    }

    .topActions{
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap: wrap;
      justify-content: flex-end;
    }

    .chip{
      display:inline-flex;
      gap:8px;
      align-items:center;
      padding: 9px 12px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: var(--btnBg);
      backdrop-filter: blur(8px);
      color: var(--muted);
      font-size: 13px;
      white-space: nowrap;
      font-weight: 700;
    }

    .btn{
      border: 1px solid var(--border);
      background: var(--btnBg);
      color: var(--text);
      padding: 10px 14px;
      border-radius: 999px;
      cursor:pointer;
      transition: .14s ease;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:8px;
      user-select:none;
      font-weight: 900;
    }
    .btn:hover{ transform: translateY(-1px); }
    .btn:active{ transform: translateY(0px); }

    .btn.gold{
      background: linear-gradient(180deg, var(--gold2), var(--gold));
      border-color: rgba(0,0,0,.18);
      color: #1b1400;
      box-shadow: 0 10px 26px rgba(246,177,0,.25);
    }

    .notice{
      margin-top: 12px;
      border-radius: 999px;
      padding: 12px 16px;
      border:1px solid var(--border);
      background: var(--btnBg);
      color: var(--muted);
      backdrop-filter: blur(8px);
      text-align:center;
      font-size: 13px;
      line-height: 1.55;
      font-weight: 700;
    }

    /* ===== Main Tabs (Calculator / Info) ===== */
    .mainTabs{
      margin-top: 14px;
      display:flex;
      justify-content:center;
      gap: 12px;
      flex-wrap: wrap;
    }
    .tab{
      min-width: 220px;
      padding: 12px 16px;
      border-radius: 999px;
      border:1px solid var(--border);
      background: var(--btnBg);
      color: var(--text);
      cursor:pointer;
      display:inline-flex;
      align-items:center;
      justify-content:center;
      gap:10px;
      user-select:none;
      font-weight: 900;
    }
    .tab.active{
      background: rgba(246,177,0,.16);
      border-color: rgba(246,177,0,.40);
      box-shadow: 0 12px 30px rgba(246,177,0,.12);
    }

    /* ===== Panels ===== */
    .panel{
      margin-top: 16px;
      border-radius: var(--radius);
      border: 1px solid var(--border);
      background: linear-gradient(180deg, var(--card1), var(--card2));
      box-shadow: var(--shadow);
      overflow:hidden;
    }
    html[data-theme="light"] .panel{
      background: linear-gradient(180deg, rgba(255,255,255,.88), rgba(255,255,255,.78));
    }

    .panelHeader{
      padding: 18px 18px 0;
      text-align:center;
    }
    .panelHeader h2{
      margin: 0;
      font-size: 28px;
      letter-spacing: .2px;
      font-weight: 900;
    }
    .panelHeader p{
      margin: 8px 0 0;
      color: var(--muted);
      font-size: 14px;
      line-height: 1.6;
      padding: 0 10px 10px;
      font-weight: 600;
    }

    /* --- Sub Mode Switches --- */
    .modeSwitch {
      display: flex;
      justify-content: center;
      gap: 10px;
      margin: 10px 0 15px;
    }
    .modeBtn {
      padding: 8px 16px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--btnBg);
      color: var(--muted);
      cursor: pointer;
      font-weight: 700;
      font-size: 13px;
      transition: .2s;
    }
    .modeBtn.active {
      background: var(--text);
      color: var(--bg1);
      border-color: var(--text);
    }
    html[data-theme="light"] .modeBtn.active {
      background: var(--text);
      color: #fff;
    }

    .content{ padding: 18px; }

    .grid2{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap: 12px;
      margin-bottom: 14px;
    }
    /* Helper to hide section */
    .hidden { display: none !important; }

    @media (max-width: 860px){
      .grid2{ grid-template-columns: 1fr; }
      .panelHeader h2{ font-size: 24px; }
      .titleBlock h1{ font-size: 26px; }
      .brand{ min-width: unset; }
      .logo{ width: 78px; height: 48px; }
    }

    .field{
      display:flex;
      flex-direction:column;
      gap: 6px;
    }
    .label{
      font-size: 12px;
      color: rgba(234,242,255,.86);
      font-weight: 900;
    }
    html[data-theme="light"] .label{ color: rgba(11,18,32,.78); }

    input, select, textarea{
      width:100%;
      border-radius: 14px;
      border: 1px solid var(--inputBorder);
      background: var(--input);
      color: var(--text);
      padding: 12px 12px;
      outline:none;
      font-size: 14px;
      font-weight: 700;
    }
    input::placeholder{ color: rgba(234,242,255,.55); font-weight: 600; }
    html[data-theme="light"] input::placeholder{ color: rgba(11,18,32,.45); }

    input:focus, select:focus, textarea:focus{
      box-shadow: 0 0 0 4px var(--focus);
      border-color: rgba(246,177,0,.55);
    }

    .ruleBox{
      margin: 14px 0 0;
      border-radius: 16px;
      border: 1px solid var(--border);
      background: rgba(255,255,255,.06);
      padding: 12px 14px;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
      text-align: center;
      font-weight: 700;
    }
    html[data-theme="light"] .ruleBox{ background: rgba(255,255,255,.70); }

    /* ===== Course table rows ===== */
    .table{
      margin-top: 14px;
      border-radius: 16px;
      border: 1px solid var(--border);
      overflow:hidden;
      background: rgba(0,0,0,.10);
    }
    html[data-theme="light"] .table{ background: rgba(255,255,255,.55); }

    .thead, .trow{
      display:grid;
      grid-template-columns: 110px 120px 140px 140px 1fr 120px;
      gap: 10px;
      align-items:center;
      padding: 12px 12px;
    }
    .thead{
      background: rgba(255,255,255,.06);
      color: rgba(234,242,255,.82);
      font-size: 12px;
      font-weight: 900;
    }
    html[data-theme="light"] .thead{
      background: rgba(0,0,0,.03);
      color: rgba(11,18,32,.78);
    }
    .trow{
      border-top: 1px solid rgba(255,255,255,.08);
      font-weight: 700;
    }
    html[data-theme="light"] .trow{
      border-top: 1px solid rgba(0,0,0,.06);
    }

    @media (max-width: 980px){
      .thead, .trow{ grid-template-columns: 110px 120px 140px 1fr; }
      .hide-md{ display:none; }
    }
    @media (max-width: 620px){
      .thead, .trow{ grid-template-columns: 110px 1fr; }
      .hide-sm{ display:none; }
    }

    .cell{ min-width:0; }
    .codeInput{ font-family: var(--mono); letter-spacing: .2px; }

    .badge{
      display:inline-flex;
      align-items:center;
      justify-content:center;
      padding: 7px 10px;
      border-radius: 999px;
      border: 1px solid rgba(255,255,255,.14);
      background: rgba(255,255,255,.06);
      color: rgba(234,242,255,.92);
      font-size: 12px;
      gap: 6px;
      white-space: nowrap;
      font-weight: 900;
    }
    html[data-theme="light"] .badge{
      border-color: rgba(0,0,0,.10);
      background: rgba(255,255,255,.65);
      color: rgba(11,18,32,.88);
    }
    .badge.ok{ border-color: rgba(78,226,154,.35); background: rgba(78,226,154,.12); }
    .badge.warn{ border-color: rgba(246,177,0,.35); background: rgba(246,177,0,.12); }

    .mini{
      font-size: 12px;
      color: var(--muted);
      line-height: 1.35;
      font-weight: 700;
    }

    .actions{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      margin-top: 14px;
      align-items:center;
      justify-content: space-between;
    }
    .actionsLeft, .actionsRight{
      display:flex;
      gap: 10px;
      flex-wrap: wrap;
      align-items:center;
    }

    .bigResult{
      margin-top: 18px;
      text-align:center;
      padding: 18px 16px 10px;
    }
    .bigNumber{
      font-size: 52px;
      letter-spacing: .6px;
      margin: 4px 0 0;
      font-weight: 900;
    }
    .bigCaption{
      margin: 6px 0 0;
      color: var(--muted);
      font-size: 13px;
      line-height: 1.6;
      font-weight: 700;
    }

    /* ===== Info page (like screenshot) ===== */
    .infoTopTabs{
      display:flex;
      gap:8px;
      justify-content:flex-start;
      margin: 4px 0 10px;
      flex-wrap: wrap;
    }
    .pill{
      padding: 8px 12px;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--btnBg);
      cursor:pointer;
      font-weight: 900;
      color: var(--text);
      display:inline-flex;
      align-items:center;
      gap:8px;
    }
    .pill.active{
      background: rgba(59,130,246,.18);
      border-color: rgba(59,130,246,.45);
    }

    .sectionTitle{
      display:flex;
      align-items:center;
      gap:8px;
      font-weight: 900;
      margin: 14px 0 8px;
      color: var(--text);
    }
    .divider{
      height:1px;
      background: rgba(255,255,255,.12);
      border:0;
      margin: 8px 0 10px;
    }
    html[data-theme="light"] .divider{ background: rgba(0,0,0,.10); }

    .infoCard{
      border:1px solid rgba(255,255,255,.12);
      border-radius: 16px;
      background: rgba(0,0,0,.10);
      padding: 12px 12px;
    }
    html[data-theme="light"] .infoCard{
      background: rgba(255,255,255,.55);
      border-color: rgba(0,0,0,.10);
    }

    /* accordion */
    details{
      border: 1px solid rgba(255,255,255,.12);
      border-radius: 14px;
      background: rgba(255,255,255,.06);
      padding: 10px 12px;
      margin-top: 10px;
    }
    html[data-theme="light"] details{
      border-color: rgba(0,0,0,.10);
      background: rgba(255,255,255,.65);
    }
    summary{
      cursor:pointer;
      font-weight: 900;
      color: var(--text);
      list-style: none;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
    }
    summary::-webkit-details-marker{ display:none; }
    .faqBody{
      margin-top: 10px;
      color: var(--muted);
      font-weight: 700;
      line-height: 1.65;
      font-size: 13px;
    }

    /* footer */
    .siteFooter{
      margin-top: 18px;
      text-align:center;
      color: var(--muted);
      font-size: 12px;
      line-height: 1.6;
      padding: 18px 12px 0;
      font-weight: 700;
    }
    .siteFooter a{
      color: var(--muted);
      text-decoration: underline;
      text-underline-offset: 3px;
    }

    @media print{
      body{ background:#fff; color:#111; }
      .topbar, .mainTabs, .notice, .actions, .siteFooter, .modeSwitch { display:none !important; }
      .panel{ box-shadow:none; border:1px solid #ddd; background:#fff; }
      .table{ border:1px solid #ddd; background:#fff; }
      .thead{ background:#f3f4f6; color:#111; }
      input, select { border:1px solid #ddd; background:#fff; color:#111; }
      .bigNumber{ color:#111; }
      .bigCaption, .mini{ color:#333; }
      .hidden { display: grid !important; } /* Force show prev data in print if user filled it */
    }
  </style>
</head>

<body>
  <div class="toast" id="toast"></div>

  <div class="wrap" id="top">
    <div class="topbar">
      <div class="brand">
        <img class="logo" src="./aou-logo.png" alt="Arab Open University Logo" onerror="this.style.display='none'">
        <div class="titleBlock">
          <h1 data-i18n="appTitle">AOU GPA Calculator</h1>
          <p data-i18n="appSub">Calculate semester GPA and estimate cumulative GPA on a 4.0 scale (AOU policy)</p>
        </div>
      </div>

      <div class="topActions">
        <span class="chip" id="scaleChip" data-i18n="scaleChip">Scale: 4.0</span>
        <button class="btn" id="btnCopyLink" type="button" data-i18n="copyLink">Copy link</button>
        <button class="btn" id="btnTheme" type="button" title="Theme">üåô</button>
        <button class="btn" id="btnAR" type="button">AR</button>
        <button class="btn" id="btnEN" type="button">EN</button>
      </div>
    </div>

    <div class="notice" data-i18n="notice">
      Notice: This is a student guidance tool and not an official university system.
    </div>

    <div class="mainTabs">
      <button class="tab active" id="tabCalc" type="button"><span>üßÆ</span><span data-i18n="tabCalc">Calculator</span></button>
      <button class="tab" id="tabInfo" type="button"><span>‚ÑπÔ∏è</span><span data-i18n="tabInfo">Information</span></button>
    </div>

    <section class="panel" id="panelCalc">
      <div class="panelHeader">
        <h2 data-i18n="calcTitle">GPA Calculator</h2>
        <p data-i18n="calcDesc">Calculate GPA by adding courses.</p>
        
        <div class="modeSwitch">
          <button class="modeBtn active" id="btnModeCurrent" data-i18n="modeCurrent">Current (Semester)</button>
          <button class="modeBtn" id="btnModeExpected" data-i18n="modeExpected">Expected (Cumulative)</button>
        </div>
      </div>

      <div class="content">
        <div class="grid2 hidden" id="blockPrevData">
          <div class="field">
            <div class="label" data-i18n="prevGpa">Previous cumulative GPA (0‚Äì4)</div>
            <input id="prevGpa" type="number" step="0.01" min="0" max="4" placeholder="e.g., 2.82">
          </div>
          <div class="field">
            <div class="label" data-i18n="prevHours">Total completed credit hours</div>
            <input id="prevHours" type="number" step="1" min="0" placeholder="e.g., 103">
          </div>
        </div>

        <div class="ruleBox" data-i18n="rule">
          Retake Rule: If you enter the same Course Code multiple times, only the latest attempt is counted.
        </div>

        <div class="table">
          <div class="thead">
            <div class="cell" data-i18n="colAction">Action</div>
            <div class="cell hide-sm" data-i18n="colStatus">Status</div>
            <div class="cell hide-md" data-i18n="colPoints">GPA Points</div>
            <div class="cell hide-md" data-i18n="colHours">Credit Hours</div>
            <div class="cell" data-i18n="colScore">Grade (0‚Äì100)</div>
            <div class="cell" data-i18n="colCode">Course Code</div>
          </div>
          <div id="rows"></div>
        </div>

        <div class="actions">
          <div class="actionsLeft">
            <button class="btn" id="btnExport" type="button" data-i18n="exportJson">Export (JSON)</button>
            <button class="btn" id="btnImport" type="button" data-i18n="importJson">Import (JSON)</button>
            <input id="importFile" type="file" accept="application/json" style="display:none">
            <button class="btn" id="btnReset" type="button" data-i18n="reset">Reset</button>
          </div>
          <div class="actionsRight">
            <button class="btn gold" id="btnCalc" type="button" data-i18n="calculate">Calculate</button>
            <button class="btn gold" id="btnAdd" type="button" data-i18n="addCourse">Add Course</button>
            <button class="btn" id="btnPrint" type="button" data-i18n="print">Print</button>
          </div>
        </div>

        <div class="bigResult">
          <div class="bigNumber" id="semGpa">0.00</div>
          <div class="bigCaption" id="semCaption" data-i18n="semCaption">Semester GPA</div>

          <div id="blockCumResult" class="hidden">
            <div style="height:14px"></div>
            <div class="bigNumber" id="cumGpa">0.00</div>
            <div class="bigCaption" id="cumCaption" data-i18n="cumCaption">Estimated Cumulative GPA</div>
          </div>
        </div>

        <p class="mini" style="margin-top:10px; text-align:center;" data-i18n="tipDecimal">
          Tip: You can enter decimals (e.g., 88.5).
        </p>
      </div>
    </section>

    <section class="panel" id="panelInfo" style="display:none">
      <div class="panelHeader" style="text-align:left">
        <div class="infoTopTabs">
          <button class="pill" id="infoEN" type="button">English</button>
          <button class="pill" id="infoAR" type="button">ÿßŸÑÿπÿ±ÿ®Ÿäÿ©</button>
        </div>
        <h2 id="infoTitle">GPA Calculator Information</h2>
      </div>

      <div class="content">
        <div class="sectionTitle">‚ÑπÔ∏è <span id="aboutTitle">About This Calculator</span></div>
        <hr class="divider">
        <div class="infoCard">
          <div class="mini" id="aboutText">
            This GPA calculator is designed for Arab Open University (AOU) students.
          </div>
        </div>

        <div class="sectionTitle">üéì <span id="scaleTitle">Grading Scale</span></div>
        <hr class="divider">
        <div class="table" style="margin-top:0">
          <div class="thead" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="cell" id="gsCol1">Letter Grade</div>
            <div class="cell" id="gsCol2">Grade Points</div>
            <div class="cell" id="gsCol3">Percentage</div>
          </div>
          <div class="trow" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="cell">A</div><div class="cell">4.0</div><div class="cell">90‚Äì100%</div>
          </div>
          <div class="trow" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="cell">B+</div><div class="cell">3.5</div><div class="cell">82‚Äì89%</div>
          </div>
          <div class="trow" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="cell">B</div><div class="cell">3.0</div><div class="cell">74‚Äì81%</div>
          </div>
          <div class="trow" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="cell">C+</div><div class="cell">2.5</div><div class="cell">66‚Äì73%</div>
          </div>
          <div class="trow" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="cell">C</div><div class="cell">2.0</div><div class="cell">58‚Äì65%</div>
          </div>
          <div class="trow" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="cell">D</div><div class="cell">1.0</div><div class="cell">50‚Äì57%</div>
          </div>
          <div class="trow" style="grid-template-columns: 1fr 1fr 1fr;">
            <div class="cell">F</div><div class="cell">0.0</div><div class="cell">Below 50%</div>
          </div>
        </div>

        <div class="sectionTitle">‚ùì <span id="faqTitle">Frequently Asked Questions</span></div>
        <hr class="divider">

        <details open>
          <summary><span id="q1">How do I use this calculator?</span><span>‚ñæ</span></summary>
          <div class="faqBody" id="a1">
            Choose "Current" for just semester GPA, or "Expected" to include previous GPA. Add courses, then click Calculate.
          </div>
        </details>

        <div class="siteFooter">
          Built by <strong>Homam Shaaban</strong>.<br>
          <a href="#top" onclick="window.scrollTo({top:0,behavior:'smooth'});return false;">Back to top</a>
        </div>
      </div>
    </section>

    <div class="siteFooter">
      ¬© <span id="year"></span> AOU GPA Calculator ‚Äî All rights reserved.
    </div>
  </div>

<script>
/* =========================
   AOU Scale
========================= */
function aouFromScore(score){
  if (!Number.isFinite(score)) return { letter: "‚Äî", points: null };
  if (score >= 90) return { letter: "A", points: 4.0 };
  if (score >= 82) return { letter: "B+", points: 3.5 };
  if (score >= 74) return { letter: "B", points: 3.0 };
  if (score >= 66) return { letter: "C+", points: 2.5 };
  if (score >= 58) return { letter: "C", points: 2.0 };
  if (score >= 50) return { letter: "D", points: 1.0 };
  return { letter: "F", points: 0.0 };
}
function clampScore(v){
  if (!Number.isFinite(v)) return null;
  if (v < 0) return 0;
  if (v > 100) return 100;
  return v;
}
function safeUpper(s){ return String(s || "").trim().toUpperCase(); }
function $(id){ return document.getElementById(id); }

/* =========================
   i18n
========================= */
const i18n = {
  en: {
    appTitle: "AOU GPA Calculator",
    appSub: "Calculate semester GPA and estimate cumulative GPA",
    scaleChip: "Scale: 4.0",
    copyLink: "Copy link",
    notice: "Notice: This is a student guidance tool and not an official university system.",
    tabCalc: "Calculator",
    tabInfo: "Information",
    calcTitle: "GPA Calculator",
    calcDesc: "Choose mode below:",
    
    modeCurrent: "Current (Semester)",
    modeExpected: "Expected (Cumulative)",

    prevGpa: "Previous cumulative GPA (0‚Äì4)",
    prevHours: "Total completed credit hours",

    rule: "Retake Rule: Latest attempt counts, previous are Replaced.",
    colAction: "Action",
    colStatus: "Status",
    colPoints: "GPA Points",
    colHours: "Credit Hours",
    colScore: "Grade (0‚Äì100)",
    colCode: "Course Code",

    addCourse: "Add Course",
    calculate: "Calculate",
    reset: "Reset",
    exportJson: "Export (JSON)",
    importJson: "Import (JSON)",
    print: "Print",

    semCaption: "Semester GPA",
    cumCaption: "Estimated Cumulative GPA",

    statusCounted: "Counted",
    statusReplaced: "Replaced",
    del: "Delete",

    placeholderCode: "e.g., ITC101",
    placeholderScore: "e.g., 88.5",
    placeholderHours: "e.g., 3",

    toastLink: "Link copied ‚úÖ",
    toastJson: "JSON exported ‚úÖ",
    toastImported: "Imported ‚úÖ",
    toastReset: "Reset ‚úÖ",
    alertInvalidRow: "Please enter Course Code, Credit Hours, and Grade (0‚Äì100).",
    tipDecimal: "Tip: You can enter decimals (e.g., 88.5)."
  },
  ar: {
    appTitle: "ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑŸÖÿπÿØŸÑ - ÿßŸÑÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑŸÖŸÅÿ™Ÿàÿ≠ÿ©",
    appSub: "ÿßÿ≠ÿ≥ÿ® ŸÖÿπÿØŸÑ ÿßŸÑŸÅÿµŸÑ Ÿàÿ™ŸàŸÇÿπ ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä",
    scaleChip: "Scale: 4.0",
    copyLink: "ŸÜÿ≥ÿÆ ÿßŸÑÿ±ÿßÿ®ÿ∑",
    notice: "ÿ™ŸÜÿ®ŸäŸá: ÿ£ÿØÿßÿ© ÿ∑ŸÑÿßÿ®Ÿäÿ© ŸÑŸÑÿ•ÿ±ÿ¥ÿßÿØ ŸÅŸÇÿ∑ ŸàŸÑŸäÿ≥ÿ™ ŸÜÿ∏ÿßŸÖŸãÿß ÿ±ÿ≥ŸÖŸäŸãÿß.",
    tabCalc: "ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿ©",
    tabInfo: "ŸÖÿπŸÑŸàŸÖÿßÿ™",
    calcTitle: "ÿ≠ÿßÿ≥ÿ®ÿ© ÿßŸÑŸÖÿπÿØŸÑ",
    calcDesc: "ÿßÿÆÿ™ÿ± ŸÜŸàÿπ ÿßŸÑÿ≠ÿ≥ÿßÿ®:",

    modeCurrent: "ŸÖÿπÿØŸÑ ŸÅÿµŸÑŸä (ÿßŸÑÿ≠ÿßŸÑŸä)",
    modeExpected: "ŸÖÿπÿØŸÑ ŸÖÿ™ŸàŸÇÿπ (ÿ™ÿ±ÿßŸÉŸÖŸä)",

    prevGpa: "ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä ÿßŸÑÿ≥ÿßÿ®ŸÇ (0‚Äì4)",
    prevHours: "ÿ•ÿ¨ŸÖÿßŸÑŸä ÿßŸÑÿ≥ÿßÿπÿßÿ™ ÿßŸÑŸÖŸÜÿ¨ÿ≤ÿ© ÿ≥ÿßÿ®ŸÇŸãÿß",

    rule: "ŸÇÿßÿπÿØÿ© ÿßŸÑÿ•ÿπÿßÿØÿ©: ŸäŸèÿ≠ÿ≥ÿ® ÿ¢ÿÆÿ± ŸÖÿ≠ÿßŸàŸÑÿ© ŸÑŸÑŸÖŸÇÿ±ÿ± ŸÅŸÇÿ∑.",
    colAction: "ÿ•ÿ¨ÿ±ÿßÿ°",
    colStatus: "ÿ≠ÿßŸÑÿ©",
    colPoints: "ŸÜŸÇÿßÿ∑",
    colHours: "ÿ≥ÿßÿπÿßÿ™",
    colScore: "ÿßŸÑÿØÿ±ÿ¨ÿ© (0‚Äì100)",
    colCode: "ŸÉŸàÿØ ÿßŸÑŸÖŸÇÿ±ÿ±",

    addCourse: "ÿ•ÿ∂ÿßŸÅÿ© ŸÖŸÇÿ±ÿ±",
    calculate: "ÿßÿ≠ÿ≥ÿ®",
    reset: "ÿ•ÿπÿßÿØÿ© ÿ∂ÿ®ÿ∑",
    exportJson: "ÿ™ÿµÿØŸäÿ±",
    importJson: "ÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ",
    print: "ÿ∑ÿ®ÿßÿπÿ©",

    semCaption: "ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑŸÅÿµŸÑŸä",
    cumCaption: "ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä ÿßŸÑŸÖÿ™ŸàŸÇÿπ",

    statusCounted: "ŸÖŸèÿ≠ÿ™ÿ≥ÿ®",
    statusReplaced: "ŸÖÿ≥ÿ™ÿ®ÿØŸÑ",
    del: "ÿ≠ÿ∞ŸÅ",

    placeholderCode: "ŸÖÿ´ÿßŸÑ: ITC101",
    placeholderScore: "ŸÖÿ´ÿßŸÑ: 88.5",
    placeholderHours: "ŸÖÿ´ÿßŸÑ: 3",

    toastLink: "ÿ™ŸÖ ÿßŸÑŸÜÿ≥ÿÆ ‚úÖ",
    toastJson: "ÿ™ŸÖ ÿßŸÑÿ™ÿµÿØŸäÿ± ‚úÖ",
    toastImported: "ÿ™ŸÖ ÿßŸÑÿßÿ≥ÿ™Ÿäÿ±ÿßÿØ ‚úÖ",
    toastReset: "ÿ™ŸÖÿ™ ÿ•ÿπÿßÿØÿ© ÿßŸÑÿ∂ÿ®ÿ∑ ‚úÖ",
    alertInvalidRow: "ÿ£ÿØÿÆŸÑ ÿßŸÑŸÉŸàÿØÿå ÿßŸÑÿ≥ÿßÿπÿßÿ™ÿå ŸàÿßŸÑÿØÿ±ÿ¨ÿ© ŸÑŸÉŸÑ ŸÖŸÇÿ±ÿ±.",
    tipDecimal: "ŸÖŸÑÿßÿ≠ÿ∏ÿ©: ÿ™ŸÇÿ®ŸÑ ÿßŸÑŸÅŸàÿßÿµŸÑ (ŸÖÿ´ÿßŸÑ 88.5)."
  }
};

const STORAGE_KEY = "aou_gpa_v4";
const THEME_KEY = "site_theme";
const LANG_KEY = "site_lang";
let LANG = "en";
let CALC_MODE = "current"; // 'current' or 'expected'

function t(key){
  return (i18n[LANG] && i18n[LANG][key]) ? i18n[LANG][key] : key;
}

function toast(msg){
  const el = $("toast");
  el.textContent = msg;
  el.style.display = "block";
  clearTimeout(window.__toastTimer);
  window.__toastTimer = setTimeout(()=>{ el.style.display = "none"; }, 1400);
}

/* =========================
   Theme / Lang
========================= */
function applyTheme(theme){
  document.documentElement.setAttribute("data-theme", theme);
  localStorage.setItem(THEME_KEY, theme);
  updateThemeButton();
}
function getPreferredTheme(){
  const saved = localStorage.getItem(THEME_KEY);
  return (saved === "light" || saved === "dark") ? saved : "dark";
}
function updateThemeButton(){
  const theme = document.documentElement.getAttribute("data-theme");
  $("btnTheme").textContent = (theme === "dark") ? "üåô" : "‚òÄÔ∏è";
}

function setLang(lang){
  LANG = lang;
  localStorage.setItem(LANG_KEY, lang);
  document.documentElement.lang = lang;
  document.documentElement.dir = (lang === "ar") ? "rtl" : "ltr";
  document.querySelectorAll("[data-i18n]").forEach(el=>{
    el.textContent = t(el.getAttribute("data-i18n"));
  });
  updateAllRowPlaceholders();
  // also update info pills
  $("infoEN").classList.toggle("active", lang==="en");
  $("infoAR").classList.toggle("active", lang==="ar");
  updateInfoText();
}

/* =========================
   Mode Switching (Current vs Expected)
========================= */
function setCalcMode(mode){
  CALC_MODE = mode;
  // Update Buttons
  const isExp = (mode === "expected");
  $("btnModeCurrent").classList.toggle("active", !isExp);
  $("btnModeExpected").classList.toggle("active", isExp);

  // Toggle Visibility
  if(isExp){
    $("blockPrevData").classList.remove("hidden");
    // Show cumulative result placeholder if calculated? 
    // We let compute() handle showing the result number.
  } else {
    $("blockPrevData").classList.add("hidden");
    $("blockCumResult").classList.add("hidden");
  }
}

/* =========================
   Rows UI
========================= */
function rowTemplate(data = {}){
  const code = data.code ?? "";
  const score = (data.score ?? "") === "" ? "" : String(data.score);
  const hours = (data.hours ?? "") === "" ? "" : String(data.hours);

  const div = document.createElement("div");
  div.className = "trow";
  div.innerHTML = `
    <div class="cell">
      <button class="btn" style="border-color: rgba(255,91,91,.45); background: rgba(255,91,91,.10);" type="button" data-act="del">${t("del")}</button>
    </div>
    <div class="cell hide-sm">
      <span class="badge warn" data-act="status">${t("statusCounted")}</span>
    </div>
    <div class="cell hide-md">
      <span class="badge" data-act="points">‚Äî</span>
    </div>
    <div class="cell hide-md">
      <input data-act="hours" type="number" min="0" step="1" placeholder="${t("placeholderHours")}" value="${hours}">
    </div>
    <div class="cell">
      <input data-act="score" type="number" min="0" max="100" step="0.01" placeholder="${t("placeholderScore")}" value="${score}">
    </div>
    <div class="cell">
      <input data-act="code" class="codeInput" type="text" placeholder="${t("placeholderCode")}" value="${code}">
    </div>
  `;
  return div;
}

function addRow(data){
  const row = rowTemplate(data);
  $("rows").appendChild(row);
  row.querySelector('[data-act="del"]').addEventListener("click", ()=>{
    row.remove();
    if($("rows").children.length === 0) addRow();
    compute(false);
  });
  ["code","score","hours"].forEach(act=>{
    row.querySelector(`[data-act="${act}"]`).addEventListener("input", ()=>{
      updateRowComputed(row);
    });
  });
  updateRowComputed(row);
}

function updateRowComputed(row){
  const scoreEl = row.querySelector('[data-act="score"]');
  const score = Number(scoreEl.value);
  const gp = aouFromScore(score);
  
  const ptBadge = row.querySelector('[data-act="points"]');
  if(scoreEl.value !== "" && Number.isFinite(score)){
    ptBadge.textContent = gp.points !== null ? gp.points.toFixed(1) : "‚Äî";
  } else {
    ptBadge.textContent = "‚Äî";
  }
}

function updateAllRowPlaceholders(){
  Array.from($("rows").children).forEach(row=>{
    row.querySelector('[data-act="del"]').textContent = t("del");
    row.querySelector('[data-act="hours"]').placeholder = t("placeholderHours");
    row.querySelector('[data-act="score"]').placeholder = t("placeholderScore");
    row.querySelector('[data-act="code"]').placeholder = t("placeholderCode");
  });
}

/* =========================
   Logic
========================= */
function extractRows(){
  const rows = Array.from($("rows").children);
  const parsed = rows.map((row, idx)=>{
    const code = safeUpper(row.querySelector('[data-act="code"]').value);
    const scoreVal = row.querySelector('[data-act="score"]').value;
    const hoursVal = row.querySelector('[data-act="hours"]').value;
    return { 
      idx, row, code, 
      score: (scoreVal==="")?NaN:Number(scoreVal), 
      hours: (hoursVal==="")?NaN:Number(hoursVal) 
    };
  });

  // Retake Logic
  const lastIndex = new Map();
  parsed.forEach(p=>{ if(p.code) lastIndex.set(p.code, p.idx); });

  parsed.forEach(p=>{
    const statusEl = p.row.querySelector('[data-act="status"]');
    if(!p.code){
      statusEl.textContent = t("statusCounted");
      statusEl.className = "badge warn";
      return;
    }
    const isLast = lastIndex.get(p.code) === p.idx;
    statusEl.textContent = isLast ? t("statusCounted") : t("statusReplaced");
    statusEl.className = isLast ? "badge ok" : "badge warn";
  });

  return parsed.filter(p=>{
    if(!p.code) return true; 
    return lastIndex.get(p.code) === p.idx;
  });
}

function compute(showAlerts = true){
  const counted = extractRows();
  let totalPoints = 0;
  let totalHours = 0;

  for(const p of counted){
    if(!p.code) continue;
    if(!Number.isFinite(p.hours) || !Number.isFinite(p.score)){
       if(showAlerts) alert(t("alertInvalidRow"));
       return;
    }
    const gp = aouFromScore(clampScore(p.score));
    totalHours += p.hours;
    totalPoints += (gp.points * p.hours);
  }

  const sem = (totalHours > 0) ? (totalPoints / totalHours) : 0;
  $("semGpa").textContent = sem.toFixed(2);

  // Cumulative
  if(CALC_MODE === "expected"){
    $("blockCumResult").classList.remove("hidden");
    const prevGpa = Number($("prevGpa").value);
    const prevHours = Number($("prevHours").value);
    let cum = sem;
    if(Number.isFinite(prevGpa) && Number.isFinite(prevHours) && prevHours > 0){
      const finalHours = prevHours + totalHours;
      const finalPoints = (prevGpa * prevHours) + totalPoints;
      cum = (finalHours > 0) ? (finalPoints / finalHours) : 0;
    }
    $("cumGpa").textContent = cum.toFixed(2);
  } else {
    $("blockCumResult").classList.add("hidden");
  }
}

/* =========================
   Info Text
========================= */
function updateInfoText(){
  if(LANG === "en"){
    $("aboutText").textContent = "This tool helps AOU students calculate Semester GPA and Forecast Cumulative GPA.";
    $("q1").textContent = "How do I use this calculator?";
    $("a1").textContent = "Select 'Current' for this semester only. Select 'Expected' to include previous GPA/Hours.";
  } else {
    $("aboutText").textContent = "ÿ£ÿØÿßÿ© ŸÑŸÖÿ≥ÿßÿπÿØÿ© ÿ∑ŸÑÿßÿ® ÿßŸÑÿ¨ÿßŸÖÿπÿ© ÿßŸÑÿπÿ±ÿ®Ÿäÿ© ÿßŸÑŸÖŸÅÿ™Ÿàÿ≠ÿ© ŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑŸÖÿπÿØŸÑ ÿßŸÑŸÅÿµŸÑŸä ŸàÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä.";
    $("q1").textContent = "ŸÉŸäŸÅ ÿ£ÿ≥ÿ™ÿÆÿØŸÖ ÿßŸÑÿ≠ÿßÿ≥ÿ®ÿ©ÿü";
    $("a1").textContent = "ÿßÿÆÿ™ÿ± 'ŸÖÿπÿØŸÑ ŸÅÿµŸÑŸä' ŸÑÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ÿ±ŸÖ ÿßŸÑÿ≠ÿßŸÑŸä ŸÅŸÇÿ∑. ÿßÿÆÿ™ÿ± 'ŸÖÿπÿØŸÑ ŸÖÿ™ŸàŸÇÿπ' ŸÑÿ•ÿØÿÆÿßŸÑ ŸÖÿπÿØŸÑŸÉ ÿßŸÑÿ≥ÿßÿ®ŸÇ Ÿàÿ≠ÿ≥ÿßÿ® ÿßŸÑÿ™ÿ±ÿßŸÉŸÖŸä ÿßŸÑÿ¨ÿØŸäÿØ.";
  }
}

/* =========================
   Init
========================= */
function init(){
  $("year").textContent = new Date().getFullYear();
  applyTheme(getPreferredTheme());
  
  // Restore lang or detect
  const savedLang = localStorage.getItem(LANG_KEY);
  if(savedLang) setLang(savedLang);
  else setLang(navigator.language.startsWith("ar") ? "ar" : "en");

  // Check Hash for default mode
  if(window.location.hash === "#forecast" || window.location.hash === "#expected"){
    setCalcMode("expected");
  } else {
    setCalcMode("current");
  }

  // Events
  $("btnAR").onclick = ()=> setLang("ar");
  $("btnEN").onclick = ()=> setLang("en");
  $("btnTheme").onclick = ()=>{
    applyTheme(document.documentElement.getAttribute("data-theme")==="dark" ? "light" : "dark");
  };
  
  $("btnModeCurrent").onclick = ()=> setCalcMode("current");
  $("btnModeExpected").onclick = ()=> setCalcMode("expected");

  $("tabCalc").onclick = ()=> {
    $("panelCalc").style.display="block"; $("panelInfo").style.display="none";
    $("tabCalc").classList.add("active"); $("tabInfo").classList.remove("active");
  };
  $("tabInfo").onclick = ()=> {
    $("panelCalc").style.display="none"; $("panelInfo").style.display="block";
    $("tabCalc").classList.remove("active"); $("tabInfo").classList.add("active");
  };

  $("btnAdd").onclick = ()=> addRow();
  $("btnCalc").onclick = ()=> compute(true);
  $("btnReset").onclick = ()=> {
     $("rows").innerHTML=""; addRow(); 
     $("prevGpa").value=""; $("prevHours").value="";
     $("semGpa").textContent="0.00";
     $("cumGpa").textContent="0.00";
     toast(t("toastReset"));
  };
  
  $("btnCopyLink").onclick = ()=>{
    navigator.clipboard.writeText(location.href);
    toast(t("toastLink"));
  };

  $("infoEN").onclick = ()=> setLang("en");
  $("infoAR").onclick = ()=> setLang("ar");

  // Initial Row
  addRow();
}

document.addEventListener("DOMContentLoaded", init);
</script>
</body>
</html>
